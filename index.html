<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Деба</title>
<meta name="robots" content="noindex, nofollow" />

<style>
:root{
  --bg:#DDE6B5;
  --pink: rgba(235, 145, 205, 0.88);
}

body{
  margin:0;
  height:100vh;
  background:var(--bg);
  overflow:hidden;
  font-family:system-ui,sans-serif;
}

/* LOGO */
#logoWrap{
  position:fixed;
  top:20px;
  left:0; right:0;
  display:flex;
  justify-content:center;
  z-index:5;
  pointer-events:none;
}
#debaLogo{
  width:min(720px,88vw);
  user-select:none;
  -webkit-user-drag:none;
}

/* CRAWL */
#crawlArea{
  position:fixed;
  inset:0;
  overflow:hidden;
  z-index:2;
}
#crawl{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  width:min(900px,92vw);
  color:var(--pink);
  font-size:clamp(15px,2vw,24px);
  font-weight:650;
  line-height:1.6;
  text-align:center;
  white-space:pre-line;
  text-shadow:
    0 1px 0 rgba(0,0,0,0.05),
    0 0 10px rgba(180,70,150,0.18);
  opacity:0;              /* hidden until music plays */
  transition: opacity .8s ease;
}

/* JACK IMAGES (spawn from bottom, then stay) */
.spawn{
  position:fixed;
  bottom:18px;
  width:min(120px,22vw);
  height:auto;
  opacity:0;
  transform: translateY(140px);
  transition:
    transform 900ms cubic-bezier(.2,.9,.2,1),
    opacity 700ms ease;
  z-index:4;
  pointer-events:none;
  user-select:none;
  -webkit-user-drag:none;
}

#jackLeft{ left:18px; }
#jackRight{ right:18px; }

body.started .spawn{
  opacity:1;
  transform: translateY(0);
}

/* UWU unlock */
#uwu{
  position:fixed;
  inset:0;
  display:none;           /* only shown if autoplay fails */
  align-items:center;
  justify-content:center;
  font-size:34px;
  font-weight:900;
  color:rgba(40,40,40,0.82);
  cursor:pointer;
  z-index:10;
  user-select:none;
  background:rgba(0,0,0,0.0);
}

/* status */
#status{
  position:fixed;
  bottom:10px;
  left:10px;
  font-size:12px;
  opacity:.7;
  padding:6px 8px;
  border-radius:10px;
  background:rgba(255,255,255,0.25);
  backdrop-filter: blur(8px);
  z-index:20;
}
</style>
</head>

<body>

<div id="logoWrap">
  <img id="debaLogo" src="assets/deba.png" alt="Деба">
</div>

<!-- spawn images (hidden until started) -->
<img id="jackLeft" class="spawn" src="assets/isisjack.png" alt="">
<img id="jackRight" class="spawn" src="assets/isisjack_flipped.png" alt="">

<div id="crawlArea">
  <div id="crawl"></div>
</div>

<div id="uwu">~ UwU ~</div>
<div id="status">loading…</div>

<audio id="music" src="assets/music.mp3" preload="auto" loop></audio>

<script>
const crawl = document.getElementById("crawl");
const music = document.getElementById("music");
const uwu = document.getElementById("uwu");
const statusEl = document.getElementById("status");

music.volume = 1.0;

let textReady = false;
let started = false;
let durationMs = 203000; // fallback
let raf = null;

/* load text (still invisible until start) */
fetch("assets/text.txt")
  .then(r => r.text())
  .then(t => {
    crawl.textContent = t.trim();
    textReady = true;
    statusEl.textContent = "ready";
  })
  .catch(() => {
    crawl.textContent = "failed to load assets/text.txt";
    textReady = true;
    statusEl.textContent = "ready (no text)";
  });

music.addEventListener("loadedmetadata", ()=>{
  if (isFinite(music.duration) && music.duration > 1) durationMs = music.duration * 1000;
});

function startScroll(){
  cancelAnimationFrame(raf);

  const screenH = window.innerHeight;
  const textH = crawl.getBoundingClientRect().height;

  const startY = screenH + 40;
  const endY   = -textH - 40;

  // show crawl only now (music is playing)
  crawl.style.opacity = "1";

  function step(){
    const tMs = (music.currentTime * 1000) % durationMs;
    const p = tMs / durationMs;
    const y = startY + (endY - startY) * p;

    crawl.style.top = `${y}px`;
    raf = requestAnimationFrame(step);
  }
  raf = requestAnimationFrame(step);
}

function hideUwu(){ uwu.style.display = "none"; }
function showUwu(){ uwu.style.display = "flex"; }

async function tryStart(){
  if (started) return;
  if (!textReady) { statusEl.textContent = "loading text…"; return; }

  statusEl.textContent = "starting…";

  try{
    await music.play();              // blocked until gesture on most browsers
    started = true;

    // mark started -> images spawn & stay
    document.body.classList.add("started");

    hideUwu();
    statusEl.textContent = "music on";
    startScroll();
  }catch{
    showUwu();
    crawl.style.opacity = "0";
    statusEl.textContent = "tap UwU";
  }
}

/* only UwU click starts it */
uwu.addEventListener("pointerdown", tryStart);

/* attempt autoplay once on load */
window.addEventListener("load", tryStart);

/* keep aligned on resize */
window.addEventListener("resize", ()=>{
  if (started) startScroll();
});

/* if tab returns, try again */
document.addEventListener("visibilitychange", ()=>{
  if (!document.hidden && !started) tryStart();
});
</script>

</body>
</html>
