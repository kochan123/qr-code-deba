<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Деба</title>
<meta name="robots" content="noindex, nofollow" />

<style>
:root { --bg:#D6E0AC; }

body{
  margin:0;
  height:100vh;
  background:var(--bg);
  overflow:hidden;
  font-family:system-ui,sans-serif;
}

/* TOP: LOGO */
#top{
  position:absolute;
  top:20px;
  left:0; right:0;
  display:flex;
  justify-content:center;
  z-index:3;
}
#debaLogo{
  width:min(720px,88vw);
  user-select:none;
  -webkit-user-drag:none;
}

/* MIDDLE: CRAWL */
#middle{
  position:absolute;
  top:20%;
  bottom:30%;
  left:0; right:0;
  display:flex;
  justify-content:center;
  pointer-events:none;
  perspective:700px;
  z-index:2;
}
.crawl{
  width:min(900px,92vw);
  color:rgba(40,40,40,0.55);
  font-size:clamp(14px,2vw,22px);
  font-weight:600;
  line-height:1.55;
  text-align:center;
  white-space:pre-line;
  transform-origin:50% 100%;
  transform:rotateX(55deg) translateY(60vh);
  animation:crawlMove 203s linear infinite;
}
@keyframes crawlMove{
  from { transform:rotateX(55deg) translateY(60vh); }
  to   { transform:rotateX(55deg) translateY(-240vh); }
}

/* BOTTOM: PIG */
#bottom{
  position:absolute;
  bottom:0;
  left:0; right:0;
  height:30vh;
  display:flex;
  justify-content:center;
  align-items:flex-end;
  z-index:3;
}
canvas{
  width:min(520px,92vw);
  height:100%;
  touch-action: manipulation;
}

#status{
  position:fixed;
  bottom:10px;
  left:10px;
  font-size:12px;
  opacity:.7;
  padding:6px 8px;
  border-radius:8px;
  background:rgba(255,255,255,0.35);
  user-select:none;
  z-index:4;
}
</style>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
  }
}
</script>
</head>

<body>
  <div id="top">
    <img id="debaLogo" src="assets/deba.png" alt="Деба">
  </div>

  <div id="middle">
    <div class="crawl">
Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Не можаха да осквернят светилището ми… дори лъвове да ги обкръжаваха
Утайката на потисничеството нападна… къде е заветът на решителните?
Забравиха, че сме горди… защитаваме се като яростните
Ние сме онези, които стъпкаха… трона на чужденците с коне

С коне – трона на чужденците

Словото, словото – мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Словото е словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Словото е словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Ние сме онези, които градиха… крепостите си от черепи
Прогонихме царя на Хосрой… с камшик като военна плячка
Нашият пратеник е създаден от нас… строители на благородна слава
Нашият пратеник е слънцето на истината… осветил лицето на световете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на народа на решимостта

Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на народа на решимостта

Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на народа на решимостта

Словото, словото на мечовете
    </div>
  </div>

  <div id="bottom">
    <canvas id="pig"></canvas>
  </div>

  <div id="status">booting…</div>

<script type="module">
import * as THREE from "three";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
import { DRACOLoader } from "three/addons/loaders/DRACOLoader.js";

const statusEl = document.getElementById("status");
const canvas = document.getElementById("pig");

function fail(e){
  console.error(e);
  statusEl.textContent = "ERROR: " + (e?.message || e);
  statusEl.style.color = "crimson";
}

const scene = new THREE.Scene();
const renderer = new THREE.WebGLRenderer({ canvas, alpha:true, antialias:true });
renderer.setPixelRatio(Math.min(devicePixelRatio || 1, 2));

const camera = new THREE.PerspectiveCamera(50, 1, 0.1, 10000);

scene.add(new THREE.AmbientLight(0xffffff,0.85));
const light = new THREE.DirectionalLight(0xffffff,1.1);
light.position.set(2,3,2);
scene.add(light);

let pig = null;
let pivot = null;              // we rotate/scale this
let baseScale = new THREE.Vector3(1,1,1);
let modelSize = new THREE.Vector3(1,1,1);

const box = new THREE.Box3();
const size = new THREE.Vector3();
const center = new THREE.Vector3();

function fitCameraToObject(obj, fitOffset = 1.25){
  box.setFromObject(obj);
  box.getSize(size);
  box.getCenter(center);

  const maxDim = Math.max(size.x, size.y, size.z);
  const fov = THREE.MathUtils.degToRad(camera.fov);
  const aspect = camera.aspect;

  const distV = (maxDim / 2) / Math.tan(fov / 2);
  const fovH = 2 * Math.atan(Math.tan(fov / 2) * aspect);
  const distH = (maxDim / 2) / Math.tan(fovH / 2);

  const dist = Math.max(distV, distH) * fitOffset;

  camera.position.set(0, maxDim * 0.10, dist);
  camera.near = dist / 100;
  camera.far  = dist * 100;
  camera.lookAt(0, 0, 0);
  camera.updateProjectionMatrix();
}

function resize(){
  const r = canvas.getBoundingClientRect();
  const w = Math.max(1, Math.floor(r.width));
  const h = Math.max(1, Math.floor(r.height));
  renderer.setSize(w, h, false);
  camera.aspect = w / h;
  camera.updateProjectionMatrix();

  if (pivot) fitCameraToObject(pivot, 1.35);
}
addEventListener("resize", resize);

// loaders
const loader = new GLTFLoader();
const draco = new DRACOLoader();
draco.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");
loader.setDRACOLoader(draco);

statusEl.textContent = "loading pig…";

loader.load(
  "assets/pig.glb",
  (gltf) => {
    pig = gltf.scene;

    // Put model inside a pivot Group so it always rotates about center
    pivot = new THREE.Group();
    pivot.add(pig);
    scene.add(pivot);

    // Center the MODEL at origin (inside pivot)
    box.setFromObject(pig);
    box.getSize(modelSize);
    box.getCenter(center);
    pig.position.sub(center);

    // Anchor model visually to bottom of the canvas area:
    // Move it DOWN by half its height, so feet are near bottom,
    // then lift it a tiny bit to avoid clipping.
    const halfH = modelSize.y / 2;
    pig.position.y -= halfH;
    pig.position.y += modelSize.y * 0.06;

    // Save scale baseline
    baseScale.copy(pivot.scale);

    resize();
    fitCameraToObject(pivot, 1.35);

    statusEl.textContent = "";
  },
  undefined,
  (err) => fail(err)
);

// bounce/stretch + gentle rotate
const BPM = 145;
const squashAmt = 0.55;
const rotateSpeed = 0.55;

function smoothPulse(x){
  return 0.5 - 0.5 * Math.cos(x * Math.PI * 2);
}

function animate(){
  requestAnimationFrame(animate);

  if (pivot) {
    const t = performance.now() * 0.001;
    const beat = 60 / BPM;
    const phase = (t / beat) % 1;
    const p = smoothPulse(phase);

    const stretch = p * squashAmt;

    const sx = 1 + (squashAmt - stretch) * 1.25;
    const sy = 1 + stretch * 1.90;
    const sz = 1 + (squashAmt - stretch) * 1.25;

    pivot.scale.set(baseScale.x * sx, baseScale.y * sy, baseScale.z * sz);
    pivot.rotation.y = t * rotateSpeed;
  }

  renderer.render(scene, camera);
}

resize();
animate();
</script>
</body>
</html>
