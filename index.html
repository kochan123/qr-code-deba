<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Деба</title>
<meta name="robots" content="noindex, nofollow" />

<style>
:root{
  --bg:#DDE6B5;
  --pink: rgba(230, 140, 200, 0.85);
}

body{
  margin:0;
  height:100vh;
  background:var(--bg);
  overflow:hidden;
  font-family:system-ui,sans-serif;
}

/* LOGO */
#logoWrap{
  position:fixed;
  top:20px;
  left:0; right:0;
  display:flex;
  justify-content:center;
  z-index:5;
  pointer-events:none;
}
#debaLogo{
  width:min(720px,88vw);
  user-select:none;
  -webkit-user-drag:none;
}

/* TEXT CRAWL */
#crawlArea{
  position:fixed;
  inset:0;
  overflow:hidden;
  z-index:2;
}

#crawl{
  position:absolute;
  left:50%;
  bottom:-120%;
  transform:translateX(-50%);
  width:min(900px,92vw);
  color:var(--pink);
  font-size:clamp(15px,2vw,24px);
  font-weight:650;
  line-height:1.6;
  text-align:center;
  white-space:pre-line;
  text-shadow:
    0 1px 0 rgba(0,0,0,0.05),
    0 0 10px rgba(180,70,150,0.18);
}

/* UwU unlock */
#uwu{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  font-size:34px;
  font-weight:900;
  color:rgba(40,40,40,0.8);
  cursor:pointer;
  z-index:10;
  user-select:none;
}

/* status */
#status{
  position:fixed;
  bottom:10px;
  left:10px;
  font-size:12px;
  opacity:.7;
  padding:6px 8px;
  border-radius:10px;
  background:rgba(255,255,255,0.25);
  backdrop-filter: blur(8px);
  z-index:20;
}
</style>
</head>

<body>

<div id="logoWrap">
  <img id="debaLogo" src="assets/deba.png" alt="Деба">
</div>

<div id="crawlArea">
  <div id="crawl"></div>
</div>

<div id="uwu">~ UwU ~</div>
<div id="status">loading…</div>

<audio id="music" src="assets/music.mp3" preload="auto" loop></audio>

<script>
const crawl = document.getElementById("crawl");
const music = document.getElementById("music");
const uwu = document.getElementById("uwu");
const statusEl = document.getElementById("status");

music.volume = 1.0;

let textReady = false;
let playing = false;
let durationMs = 203000; // fallback 3:23
let startTime = 0;
let raf = null;

/* LOAD TEXT */
fetch("assets/text.txt")
  .then(r => r.text())
  .then(t => {
    crawl.textContent = t.trim();
    textReady = true;
    statusEl.textContent = "text loaded";
  });

/* AUDIO METADATA */
music.addEventListener("loadedmetadata", ()=>{
  if (isFinite(music.duration) && music.duration > 1) {
    durationMs = music.duration * 1000;
  }
});

/* START SCROLL */
function startScroll(){
  cancelAnimationFrame(raf);

  const screenH = window.innerHeight;
  const textH = crawl.getBoundingClientRect().height;

  const startY = screenH + 40;
  const endY   = -textH - 40;

  startTime = performance.now() - (music.currentTime * 1000);

  function step(){
    const tMs = (music.currentTime * 1000) % durationMs;
    const p = tMs / durationMs;
    const y = startY + (endY - startY) * p;
    crawl.style.bottom = "auto";
    crawl.style.top = `${y}px`;
    raf = requestAnimationFrame(step);
  }
  raf = requestAnimationFrame(step);
}

/* TRY AUTOPLAY */
async function tryPlay(){
  if (playing || !textReady) return;
  try{
    await music.play();
    playing = true;
    uwu.style.display = "none";
    statusEl.textContent = "music on";
    startScroll();
  }catch{
    uwu.style.display = "flex";
    statusEl.textContent = "tap UwU";
  }
}

/* UNLOCK */
uwu.addEventListener("pointerdown", tryPlay);
window.addEventListener("keydown", tryPlay);
window.addEventListener("pointerdown", tryPlay, { once:true });

/* RESYNC ON VISIBILITY */
document.addEventListener("visibilitychange", ()=>{
  if (!document.hidden && music.paused){
    playing = false;
    tryPlay();
  }
});

/* INIT */
window.addEventListener("load", tryPlay);
</script>

</body>
</html>
