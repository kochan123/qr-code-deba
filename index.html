<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Деба</title>
  <meta name="robots" content="noindex, nofollow" />

  <style>
    :root { --bg:#D6E0AC; }

    body{
      margin:0; height:100vh;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      background:var(--bg);
      overflow:hidden;
      font-family:system-ui,sans-serif;
    }

    #debaLogo{
      width:min(720px,88vw);
      height:auto;
      margin-bottom:14px;
      user-select:none;
      -webkit-user-drag:none;
      z-index: 2;
    }

    canvas{
      width: min(90vw, 700px);
      height: min(60vh, 520px);
      max-width: 90vw;
      max-height: 60vh;
      touch-action: manipulation;
      z-index: 2;
    }

    #status{
      position:fixed; bottom:10px; left:10px;
      font-size:12px; opacity:.75;
      padding:6px 8px; border-radius:8px;
      background: rgba(255,255,255,0.35);
      user-select:none;
      z-index: 3;
    }

    /* --- Star Wars style crawl --- */
    .crawlWrap{
      position: fixed;
      inset: 0;
      pointer-events: none;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      perspective: 700px;
      z-index: 1;
      -webkit-mask-image: linear-gradient(to top, transparent 0%, black 12%, black 70%, transparent 100%);
              mask-image: linear-gradient(to top, transparent 0%, black 12%, black 70%, transparent 100%);
    }

    .crawl{
      width: min(900px, 92vw);
      color: rgba(40,40,40,0.55);
      font-weight: 600;
      line-height: 1.5;
      text-align: center;
      letter-spacing: 0.5px;
      transform-origin: 50% 100%;
      transform: rotateX(55deg) translateY(70vh);

      /* 3:23 = 203 seconds */
      animation: crawlMove 203s linear infinite;

      text-shadow: 0 1px 0 rgba(255,255,255,0.15);
      font-size: clamp(14px, 2.1vw, 22px);
      white-space: pre-line;
    }

    @keyframes crawlMove{
      0%   { transform: rotateX(55deg) translateY(70vh); }
      100% { transform: rotateX(55deg) translateY(-260vh); }
    }
  </style>

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
    }
  }
  </script>
</head>

<body>
  <div class="crawlWrap" aria-hidden="true">
    <div class="crawl">
Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Не можаха да осквернят светилището ми… дори лъвове да ги обкръжаваха
Утайката на потисничеството нападна… къде е заветът на решителните?
Забравиха, че сме горди… защитаваме се като яростните
Ние сме онези, които стъпкаха… трона на чужденците с коне

С коне – трона на чужденците

Словото, словото – мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Словото е словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Словото е словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на решителните

Ние сме онези, които градиха… крепостите си от черепи
Прогонихме царя на Хосрой… с камшик като военна плячка
Нашият пратеник е създаден от нас… строители на благородна слава
Нашият пратеник е слънцето на истината… осветил лицето на световете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на народа на решимостта

Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на народа на решимостта

Словото, словото на мечовете
Словото е словото на мечовете… за да бъдат възстановени несправедливостите
Дори низките се надигнаха… пратеникът на народа на решимостта

Словото, словото на мечовете
    </div>
  </div>

  <img id="debaLogo" src="assets/deba.png" alt="Деба">
  <canvas id="pig"></canvas>
  <div id="status">booting…</div>

  <script type="module">
    import * as THREE from "three";
    import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
    import { DRACOLoader } from "three/addons/loaders/DRACOLoader.js";

    const statusEl = document.getElementById("status");
    const canvas = document.getElementById("pig");

    function fail(e){
      console.error(e);
      statusEl.textContent = "ERROR: " + (e?.message || e);
      statusEl.style.color = "crimson";
    }

    const scene = new THREE.Scene();
    const renderer = new THREE.WebGLRenderer({ canvas, alpha:true, antialias:true });
    renderer.setPixelRatio(Math.min(devicePixelRatio || 1, 2));

    const camera = new THREE.PerspectiveCamera(55, 1, 0.1, 100000);

    scene.add(new THREE.AmbientLight(0xffffff, 0.75));
    const key = new THREE.DirectionalLight(0xffffff, 1.1);
    key.position.set(2,2,2);
    scene.add(key);

    let pig = null;

    const tmpBox = new THREE.Box3();
    const tmpSize = new THREE.Vector3();
    const tmpCenter = new THREE.Vector3();

    function fitCameraToObject(object, fitOffset = 1.65) {
      tmpBox.setFromObject(object);
      tmpBox.getSize(tmpSize);
      tmpBox.getCenter(tmpCenter);

      object.position.sub(tmpCenter);

      const maxDim = Math.max(tmpSize.x, tmpSize.y, tmpSize.z);
      const fov = THREE.MathUtils.degToRad(camera.fov);
      const aspect = camera.aspect;

      const distV = (maxDim / 2) / Math.tan(fov / 2);
      const fovH = 2 * Math.atan(Math.tan(fov / 2) * aspect);
      const distH = (maxDim / 2) / Math.tan(fovH / 2);
      const dist = Math.max(distV, distH) * fitOffset;

      camera.position.set(0, maxDim * 0.10, dist);
      camera.near = dist / 100;
      camera.far  = dist * 100;
      camera.updateProjectionMatrix();
    }

    function resize(){
      const r = canvas.getBoundingClientRect();
      const w = Math.max(1, Math.floor(r.width));
      const h = Math.max(1, Math.floor(r.height));
      renderer.setSize(w, h, false);

      camera.aspect = w / h;
      camera.updateProjectionMatrix();

      if (pig) fitCameraToObject(pig);
    }
    addEventListener("resize", resize);

    const loader = new GLTFLoader();
    const draco = new DRACOLoader();
    draco.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");
    loader.setDRACOLoader(draco);

    // === TUNE HERE ===
    const BPM = 145;
    const squashAmt = 0.55;
    const rotateSpeed = 0.55;

    const basePos = new THREE.Vector3();
    const baseScale = new THREE.Vector3(1,1,1);
    const baseQuat = new THREE.Quaternion();
    const e = new THREE.Euler(0,0,0,"YXZ");

    statusEl.textContent = "loading pig…";

    loader.load(
      "assets/pig.glb",
      (gltf) => {
        pig = gltf.scene;
        scene.add(pig);

        resize();
        fitCameraToObject(pig);

        basePos.copy(pig.position);
        baseScale.copy(pig.scale);
        baseQuat.copy(pig.quaternion);

        statusEl.textContent = "";
      },
      undefined,
      (err) => fail(err)
    );

    function smoothPulse(x){
      return 0.5 - 0.5 * Math.cos(x * Math.PI * 2);
    }

    function animate(){
      requestAnimationFrame(animate);

      if (pig) {
        const t = performance.now() * 0.001;
        const beat = 60 / BPM;
        const phase = (t / beat) % 1;
        const p = smoothPulse(phase);

        const stretch = p * squashAmt;

        const sx = 1 + (squashAmt - stretch) * 1.25;
        const sy = 1 + stretch * 1.90;
        const sz = 1 + (squashAmt - stretch) * 1.25;

        pig.scale.set(baseScale.x * sx, baseScale.y * sy, baseScale.z * sz);
        pig.position.set(basePos.x, basePos.y, basePos.z);

        e.set(0, t * rotateSpeed, 0);
        pig.quaternion.copy(baseQuat).multiply(new THREE.Quaternion().setFromEuler(e));

        if ((t % 0.5) < 0.02) fitCameraToObject(pig, 1.65);
      }

      renderer.render(scene, camera);
    }

    resize();
    animate();
  </script>
</body>
</html>
