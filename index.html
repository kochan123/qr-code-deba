<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Деба</title>
<meta name="robots" content="noindex, nofollow" />

<style>
:root{
  --bg:#D6E0AC;
  --pink: rgba(220, 120, 190, 0.75); /* light but visible pink */
}

body{
  margin:0;
  height:100vh;
  background:var(--bg);
  overflow:hidden;
  font-family:system-ui,sans-serif;
}

/* LOGO */
#top{
  position:absolute;
  top:20px;
  left:0; right:0;
  display:flex;
  justify-content:center;
  z-index:3;
}
#debaLogo{
  width:min(720px,88vw);
  user-select:none;
  -webkit-user-drag:none;
}

/* TEXT WINDOW (CLIPPED BELOW LOGO) */
#middle{
  position:absolute;
  left:0; right:0;
  bottom:0;
  overflow:hidden;
  pointer-events:none;
  z-index:2;
}

#crawlWrap{
  position:absolute;
  left:0; right:0;
  bottom:0;
  display:flex;
  justify-content:center;
  transform: translateY(100%);
}

.crawl{
  width:min(900px,92vw);
  color:var(--pink);
  font-size:clamp(15px,2vw,24px);
  font-weight:600;
  line-height:1.6;
  text-align:center;
  white-space:pre-line;
}

/* STATUS */
#status{
  position:fixed;
  bottom:10px;
  left:10px;
  font-size:12px;
  opacity:.7;
  padding:6px 8px;
  border-radius:10px;
  background:rgba(255,255,255,0.25);
  backdrop-filter: blur(8px);
  z-index:5;
}

/* UWU OVERLAY */
#uwu{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  font-size:32px;
  font-weight:800;
  color:rgba(40,40,40,0.8);
  cursor:pointer;
  z-index:10;
  user-select:none;
}
</style>
</head>

<body>

<div id="top">
  <img id="debaLogo" src="assets/deba.png" alt="Деба">
</div>

<div id="middle">
  <div id="crawlWrap">
    <div class="crawl" id="crawlText"></div>
  </div>
</div>

<div id="status">loading…</div>

<div id="uwu">~ UwU ~</div>

<audio id="bgm" src="assets/music.mp3" loop preload="auto"></audio>

<script>
const audio = document.getElementById("bgm");
const uwu = document.getElementById("uwu");
const statusEl = document.getElementById("status");
const crawlText = document.getElementById("crawlText");
const crawlWrap = document.getElementById("crawlWrap");
const middle = document.getElementById("middle");
const logo = document.getElementById("debaLogo");

audio.volume = 1.0;

let durationMs = 203000;
let startTime = null;
let raf = null;

/* POSITION CRAWL UNDER LOGO */
function setMiddleTop(){
  const r = logo.getBoundingClientRect();
  middle.style.top = `${r.bottom + 20}px`;
}

/* LOAD TEXT FROM FILE */
fetch("assets/text.txt")
  .then(r => r.text())
  .then(t => crawlText.textContent = t)
  .catch(() => crawlText.textContent = "failed to load text");

/* START CRAWL */
function startCrawl(){
  cancelAnimationFrame(raf);
  setMiddleTop();

  const winH = middle.getBoundingClientRect().height;
  const textH = crawlText.getBoundingClientRect().height;

  const startY = winH + 20;
  const endY = -textH - 40;

  startTime = performance.now();

  function step(now){
    const p = ((now - startTime) % durationMs) / durationMs;
    const y = startY + (endY - startY) * p;
    crawlWrap.style.transform = `translateY(${y}px)`;
    raf = requestAnimationFrame(step);
  }
  raf = requestAnimationFrame(step);
}

/* TRY PLAY AUDIO */
async function tryPlay(){
  try{
    await audio.play();
    uwu.style.display = "none";
    statusEl.textContent = "music on";
    startCrawl();
  }catch{
    uwu.style.display = "flex";
    statusEl.textContent = "tap UwU";
  }
}

audio.addEventListener("loadedmetadata", ()=>{
  if (audio.duration > 1) durationMs = audio.duration * 1000;
});

/* UWU = USER GESTURE */
uwu.addEventListener("pointerdown", tryPlay);
window.addEventListener("keydown", tryPlay);
window.addEventListener("pointerdown", tryPlay, { once:true });

/* RETRY WHEN TAB RETURNS */
document.addEventListener("visibilitychange", ()=>{
  if (!document.hidden) tryPlay();
});

/* INIT */
window.addEventListener("resize", ()=>{ if (!audio.paused) startCrawl(); });
window.addEventListener("load", ()=>{ setMiddleTop(); tryPlay(); });
</script>

</body>
</html>
